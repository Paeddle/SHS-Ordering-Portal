<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Data Portal</title>
  <style>
    :root{--bg:#0b1020;--card:#121a2e;--text:#e8ecf3;--muted:#9aa4b2;--accent:#6ea8fe;--accent-2:#7dd3fc;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#121528 50%,#0b1020);color:var(--text)}
    .container{max-width:1100px;margin:auto;padding:32px 16px}
    .card{background:linear-gradient(180deg,var(--card),#0f172a);border:1px solid #1f2a44;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:18px}
    h1{font-size:28px;margin:0 0 8px 0;letter-spacing:.3px}
    .muted{color:var(--muted);font-size:14px;margin:0 0 16px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:10px 0 14px}
    input[type="text"]{flex:1;min-width:240px;background:#0b1327;color:var(--text);border:1px solid #223052;border-radius:10px;padding:10px 12px;outline:none}
    input::placeholder{color:#7c8697}
    .pill{font-size:13px;color:#c9d3e6;background:#0c1a36;border:1px solid #1e2d52;border-radius:999px;padding:8px 10px;display:inline-flex;gap:8px;align-items:center}
    .pill b{color:var(--accent)}
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:6px}
    thead th{position:sticky;top:0;background:#0e1730;border-bottom:1px solid #223052;padding:10px;font-size:13px;text-align:left}
    tbody td{padding:10px;border-bottom:1px solid #1c2744;font-size:14px;vertical-align:top}
    tr:hover td{background:#0b142e}
    th.sortable{cursor:pointer}
    th.sortable .arrow{opacity:.5;margin-left:6px}
    th.sortable[data-order="asc"] .arrow{opacity:1;transform:rotate(180deg)}
    .tag{background:#102552;border:1px solid #2b3f6e;color:#cfe4ff;padding:2px 8px;border-radius:999px;font-size:12px}
    .footer{margin-top:12px;color:#93a0b5;font-size:12px}
    .hidden{display:none}
    a{color:var(--accent-2)}
    @media (max-width:720px){
      thead{display:none}
      table,tbody,tr,td{display:block;width:100%}
      tbody tr{border:1px solid #1c2744;border-radius:12px;margin:0 0 12px;padding:8px}
      tbody td{border:none;padding:6px 0}
      tbody td[data-label]:before{content:attr(data-label) " — ";color:#8ea0be;display:inline-block;width:auto;font-weight:600;margin-right:6px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Data Portal</h1>
      <p class="muted">Upload a fresh <code>data.csv</code> to update. Click column headers to sort. Use search to filter.</p>
      <div class="controls">
        <input id="search" type="text" placeholder="Search rows… (matches any column)" />
        <span class="pill"><span id="rowCount">0</span> rows • <b id="colCount">0</b> columns</span>
        <a class="pill" href="data.csv" download>Download CSV</a>
      </div>
      <div class="table-wrap">
        <table id="table">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="footer">
        Powered by GitHub Pages • This site is static and reads <code>data.csv</code> directly.
      </div>
    </div>
  </div>
<script>
// --- Minimal CSV parser (handles quotes & commas) ---
function parseCSV(text){
  const rows=[];let row=[],val='',inQ=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(inQ){
      if(c==='"'&&n==='"'){val+='"';i++;continue;}
      if(c==='"'){inQ=false;continue;}
      val+=c;
    }else{
      if(c==='"'){inQ=true;continue;}
      if(c===','){row.push(val);val='';continue;}
      if(c==='
'){row.push(val);rows.push(row);row=[];val='';continue;}
      if(c===''&&n==='
'){continue;}
      if(c===''){row.push(val);rows.push(row);row=[];val='';continue;}
      val+=c;
    }
  }
  if(val!==''||row.length){row.push(val);rows.push(row);}
  return rows;
}

async function loadCSV(){
  const res = await fetch('data.csv?cache=' + Date.now());
  if(!res.ok){document.querySelector('#table').insertAdjacentHTML('afterend','<p class="muted">Could not load data.csv</p>');return;}
  const text = await res.text();
  const grid = parseCSV(text).filter(r => r.some(v => String(v).trim()!==''));
  if(grid.length===0){return;}
  const headers = grid[0];
  const rows = grid.slice(1);
  buildTable(headers, rows);
}

function buildTable(headers, rows){
  const thead = document.querySelector('#table thead');
  const tbody = document.querySelector('#table tbody');
  thead.innerHTML=''; tbody.innerHTML='';

  const tr = document.createElement('tr');
  headers.forEach((h, idx)=>{
    const th=document.createElement('th');
    th.textContent=h;
    th.className='sortable';
    th.dataset.index=idx;
    th.dataset.order='';
    const arrow=document.createElement('span');arrow.className='arrow';arrow.textContent='▲';
    th.appendChild(arrow);
    th.addEventListener('click',()=>sortBy(idx, th));
    tr.appendChild(th);
  });
  thead.appendChild(tr);

  function renderRows(data){
    tbody.innerHTML='';
    data.forEach(r=>{
      const tr=document.createElement('tr');
      r.forEach((v,i)=>{
        const td=document.createElement('td');
        const text = String(v || '');
        // auto-link URLs
        if(/^https?:\/\//i.test(text)){
          const a=document.createElement('a'); a.href=text; a.textContent=text; a.target='_blank'; td.appendChild(a);
        }else{
          td.textContent=text;
        }
        td.dataset.label=headers[i] || ('Col ' + (i+1));
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    document.querySelector('#rowCount').textContent = data.length;
    document.querySelector('#colCount').textContent = headers.length;
  }

  renderRows(rows);

  // Search
  const search = document.getElementById('search');
  let allRows = rows.slice();
  function doFilter(){
    const q = search.value.trim().toLowerCase();
    if(!q){renderRows(allRows);return;}
    const filtered = allRows.filter(r => r.some(v => String(v).toLowerCase().includes(q)));
    renderRows(filtered);
  }
  search.addEventListener('input', debounce(doFilter, 120));

  // Sorting
  function sortBy(colIndex, th){
    const order = th.dataset.order === 'asc' ? 'desc' : 'asc';
    [...thead.querySelectorAll('th')].forEach(x=>x.dataset.order='');
    th.dataset.order = order;
    const sorted = rows.slice().sort((a,b)=>{
      const av = (a[colIndex]||'').toString();
      const bv = (b[colIndex]||'').toString();
      const an = parseFloat(av.replace(/,/g,''));
      const bn = parseFloat(bv.replace(/,/g,''));
      const bothNum = !isNaN(an) && !isNaN(bn);
      if(bothNum){
        return order==='asc' ? an - bn : bn - an;
      }else{
        return order==='asc' ? av.localeCompare(bv) : bv.localeCompare(av);
      }
    });
    renderRows(sorted);
  }

  function debounce(fn, ms){let t;return (...args)=>{clearTimeout(t);t=setTimeout(()=>fn.apply(null,args),ms);}}
}

loadCSV();
</script>
</body>
</html>
